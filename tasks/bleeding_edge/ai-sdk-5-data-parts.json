{
	"id": "ai-sdk-5-data-parts",
	"category": "bleeding_edge",
	"library": "ai",
	"target_version": "5.0.0",
	"prompt": "Using Vercel AI SDK v5, create a Route Handler that streams a chat response and includes transient \"loading status\" data parts that update during streaming. The status should show \"thinking...\" initially, update to \"generating...\" during streaming, and \"complete\" when done. Use `writer.write()` for data parts and `writer.merge()` for the main stream.",
	"reference_solution": "import { createUIMessageStream, createUIMessageStreamResponse, streamText, generateId } from 'ai';\nimport { openai } from '@ai-sdk/openai';\n\nexport async function POST(req: Request) {\n  const { messages } = await req.json();\n\n  const stream = createUIMessageStream({\n    originalMessages: messages,\n    generateId,\n    execute: ({ writer }) => {\n      const statusId = generateId();\n\n      writer.write({\n        type: 'data',\n        id: statusId,\n        data: { status: 'thinking...' },\n        transient: true,\n      });\n\n      const result = streamText({\n        model: openai('gpt-4o'),\n        messages,\n        onChunk() {\n          writer.write({\n            type: 'data',\n            id: statusId,\n            data: { status: 'generating...' },\n            transient: true,\n          });\n        },\n        onFinish() {\n          writer.write({\n            type: 'data',\n            id: statusId,\n            data: { status: 'complete' },\n          });\n        },\n      });\n\n      writer.merge(result.toUIMessageStream());\n    },\n  });\n\n  return createUIMessageStreamResponse(stream);\n}",
	"test_spec": {
		"ast_checks": [
			{
				"type": "call_exists",
				"call": "writer.write"
			},
			{
				"type": "call_exists",
				"call": "writer.merge"
			},
			{
				"type": "call_absent",
				"call": "writeData"
			},
			{
				"type": "import_absent",
				"name": "StreamData",
				"from": "ai"
			}
		]
	},
	"rubric": {
		"criteria": [
			{
				"name": "writer_write",
				"weight": 0.25,
				"description": "Uses `writer.write()` for data parts"
			},
			{
				"name": "transient_flag",
				"weight": 0.25,
				"description": "Uses `transient: true` for loading states"
			},
			{
				"name": "id_reconciliation",
				"weight": 0.2,
				"description": "Same ID used across status updates"
			},
			{
				"name": "no_v4_api",
				"weight": 0.15,
				"description": "No `writeData()` or `StreamData`"
			},
			{
				"name": "no_hallucination",
				"weight": 0.15,
				"description": "No invented APIs"
			}
		]
	},
	"common_hallucinations": [
		"Using `dataStream.writeData()` (v4)",
		"Using `StreamData` class (v3/v4)",
		"Not using `transient` flag for loading states",
		"Not using consistent IDs for reconciliation"
	]
}
