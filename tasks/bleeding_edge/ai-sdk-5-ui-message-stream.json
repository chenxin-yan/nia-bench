{
	"id": "ai-sdk-5-ui-message-stream",
	"category": "bleeding_edge",
	"library": "ai",
	"target_version": "5.0.0",
	"prompt": "Using Vercel AI SDK v5, create a Next.js Route Handler at `app/api/chat/route.ts` that streams a chat response using the new `createUIMessageStream` and `createUIMessageStreamResponse` APIs with the SSE protocol. Use `openai('gpt-4o')` as the model. The handler should receive messages from the request body.",
	"reference_solution": "import { createUIMessageStream, createUIMessageStreamResponse, streamText, generateId } from 'ai';\nimport { openai } from '@ai-sdk/openai';\n\nexport async function POST(req: Request) {\n  const { messages } = await req.json();\n\n  const stream = createUIMessageStream({\n    originalMessages: messages,\n    generateId,\n    execute: ({ writer }) => {\n      const result = streamText({\n        model: openai('gpt-4o'),\n        messages,\n      });\n\n      writer.merge(result.toUIMessageStream());\n    },\n  });\n\n  return createUIMessageStreamResponse(stream);\n}",
	"test_spec": {
		"ast_checks": [
			{
				"type": "import_exists",
				"name": "createUIMessageStream",
				"from": "ai"
			},
			{
				"type": "import_exists",
				"name": "createUIMessageStreamResponse",
				"from": "ai"
			},
			{
				"type": "import_absent",
				"name": "createDataStreamResponse",
				"from": "ai"
			},
			{
				"type": "call_absent",
				"call": "toDataStreamResponse"
			},
			{
				"type": "call_absent",
				"call": "toAIStreamResponse"
			},
			{
				"type": "call_exists",
				"call": "writer.merge"
			},
			{
				"type": "call_exists",
				"call": "result.toUIMessageStream"
			}
		],
		"type_check": false
	},
	"rubric": {
		"criteria": [
			{
				"name": "ui_message_stream",
				"weight": 0.25,
				"description": "Uses `createUIMessageStream`"
			},
			{
				"name": "ui_message_response",
				"weight": 0.2,
				"description": "Uses `createUIMessageStreamResponse`"
			},
			{
				"name": "writer_merge",
				"weight": 0.2,
				"description": "Uses `writer.merge(result.toUIMessageStream())` pattern"
			},
			{
				"name": "no_data_stream",
				"weight": 0.15,
				"description": "Does NOT use DataStream or AIStream APIs"
			},
			{
				"name": "correct_params",
				"weight": 0.1,
				"description": "Passes `originalMessages` and `generateId`"
			},
			{
				"name": "no_hallucination",
				"weight": 0.1,
				"description": "No invented APIs"
			}
		]
	},
	"common_hallucinations": [
		"Using `toDataStreamResponse()` (v4 pattern)",
		"Using `toAIStreamResponse()` (v3 pattern)",
		"Using `StreamingTextResponse` (very old v3 pattern)",
		"Not passing `originalMessages` and `generateId` to `createUIMessageStream`"
	]
}
